
appu.factory('loginService', function($http, $location, sessionFactory){
    return{
        login:function(user){
              var $promise = $http({
                method  : 'POST',
                url     : 'data/user.php',
                data    : $.param(user),
                headers : { 'Content-Type': 'application/x-www-form-urlencoded' }
                })
                    $promise.then(function(msg){
                        var uid = msg.data;
                        if(msg.data == 'success'){
                            console.log('SUCCESS login');
                            sessionFactory.set('user', uid);
                            $location.path('/profile');
                        }else{
                            console.log('FAIL login');
                            $location.path('/partialHome');
                            alert(uid);
                        }
                    });
            },
        logout: function(){
            sessionFactory.destroy('user');
            $location.path('/partialHome');
        },
        isLogged: function(){
            if(sessionFactory.get('user')) return true;
        }
    };
});

appu.factory('sessionFactory',function(){
    return{
        get: function(key){ 
           return sessionStorage.getItem(key);
        },
        set: function(key, value){
            return sessionStorage.setItem(key, value);
        },
        destroy: function(key){
            return sessionStorage.removeItem(key);
        }
    };
});
